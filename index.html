<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arduino Line Follower Advanced Simulator</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.47.0/min/vs/loader.min.js"></script>
</head>
<body>
    <header>
        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%; max-width: 1400px;">
            <div>
                <h1>Simulador de Seguidor de Lineas</h1>
                <nav class="tabs">
                    <button class="tab-button active" data-tab="introduccion">Introducci칩n</button>
                    <button class="tab-button" data-tab="simulation">Simulaci칩n</button>
                    <button class="tab-button" data-tab="code-editor">Editor de C칩digo</button>
                    <button class="tab-button" data-tab="robot-editor">Editor de Robot</button>
                    <button class="tab-button" data-tab="track-editor">Editor de Pista</button>
                </nav>
            </div>
            <img src="assets/Logo%20guaroduino.png" alt="Logo Guaroduino" class="header-logo">
        </div>
    </header>

    <main>
        <!-- Introducci칩n Tab -->
        <div id="introduccion" class="tab-content active">
            <div style="max-width:700px;margin:2em auto 0 auto;text-align:left;">
                <h2>Introducci칩n</h2>
                <h1>游뱄 Explorando el Mundo de los Robots Seguidores de L칤neas y Nuestro Simulador</h1>
                <p>춰Bienvenido a la secci칩n de aprendizaje de nuestro simulador de robots seguidores de l칤neas! Aqu칤 descubrir치s qu칠 son estos fascinantes robots, c칩mo funcionan, c칩mo se programan con Arduino y, lo m치s importante, c칩mo puedes usar nuestro simulador para dise침ar, probar y optimizar tus propios robots virtuales.</p>
                <hr>
                <h2>쯈u칠 es un Robot Seguidor de L칤neas?</h2>
                <p>Un <strong>robot seguidor de l칤neas</strong> es un veh칤culo aut칩nomo dise침ado para detectar y seguir una l칤nea dibujada en el suelo. Esta l칤nea suele ser de un color que contrasta fuertemente con la superficie (por ejemplo, una l칤nea negra sobre un fondo blanco, o viceversa). Estos robots son muy populares en el 치mbito educativo y en competencias de rob칩tica, ya que introducen conceptos fundamentales de sensado, l칩gica de control y actuaci칩n.</p>
                <p>Su funcionamiento se basa en un bucle constante de:</p>
                <ol>
                    <li><strong>Sensar:</strong> Detectar la posici칩n de la l칤nea con respecto al robot.</li>
                    <li><strong>Decidir:</strong> Aplicar una l칩gica de control para determinar c칩mo debe moverse el robot.</li>
                    <li><strong>Actuar:</strong> Mover los motores para corregir la trayectoria y mantenerse sobre la l칤nea.</li>
                </ol>
                <hr>
                <h2>Componentes T칤picos de un Robot Seguidor de L칤neas F칤sico</h2>
                <p>Aunque nuestro simulador es virtual, es 칰til conocer los componentes de un robot real para entender mejor su funcionamiento:</p>
                <ul>
                    <li><strong>Chasis:</strong> Es la estructura f칤sica del robot que sostiene todos los dem치s componentes. Su dise침o (material, forma, tama침o) puede influir en el rendimiento.</li>
                    <li><strong>Microcontrolador (Arduino):</strong> Act칰a como el "cerebro" del robot. Una placa Arduino (como Arduino UNO) es com칰nmente utilizada debido a su facilidad de programaci칩n y versatilidad. Recibe informaci칩n de los sensores y env칤a comandos a los motores.</li>
                    <li><strong>Sensores Infrarrojos (IR):</strong> Son los "ojos" del robot. T칤picamente se usan pares de emisor-detector infrarrojo (como el CNY70 o m칩dulos TCRT5000). El emisor env칤a luz IR y el detector mide cu치nta luz se refleja. Una superficie blanca refleja m치s luz IR que una negra. Con varios sensores, el robot puede saber si est치 centrado, a la izquierda o a la derecha de la l칤nea.</li>
                    <li><strong>Motores y Ruedas:</strong> Proporcionan el movimiento. Generalmente se usan dos motores de corriente continua (DC) con ruedas, permitiendo giros diferenciales (una rueda gira m치s r치pido que la otra, o en sentido contrario, para cambiar de direcci칩n).</li>
                    <li><strong>Controlador de Motores (Puente H):</strong> Un microcontrolador como Arduino no puede suministrar directamente la corriente que necesitan los motores. Un controlador de motores (por ejemplo, el L293D o L298N) act칰a como un intermediario, permitiendo al Arduino controlar la velocidad y direcci칩n de los motores.</li>
                    <li><strong>Fuente de Alimentaci칩n:</strong> Bater칤as o un paquete de pilas que proporcionan la energ칤a necesaria para todos los componentes electr칩nicos.</li>
                    <li><strong>Rueda Loca o Deslizador:</strong> Un tercer punto de apoyo (adem치s de las dos ruedas motrices) que permite al robot girar con facilidad.</li>
                </ul>
                <hr>
                <h2>Programaci칩n con Arduino IDE</h2>
                <p>Los robots seguidores de l칤neas basados en Arduino se programan utilizando el <strong>Arduino IDE (Entorno de Desarrollo Integrado)</strong>. El lenguaje de programaci칩n es una variante de C/C++.</p>
                <p>La l칩gica b치sica de control en el c칩digo de Arduino suele seguir estos pasos dentro de la funci칩n <code>loop()</code> (que se ejecuta continuamente):</p>
                <ol>
                    <li><strong>Leer los Sensores:</strong> Obtener los valores digitales (NEGRO/BLANCO) o anal칩gicos (niveles de reflexi칩n) de los sensores de l칤nea.</li>
                    <li><strong>Tomar Decisiones:</strong> Bas치ndose en las lecturas de los sensores, determinar la posici칩n del robot respecto a la l칤nea:
                        <ul>
                            <li>Si el sensor izquierdo detecta la l칤nea negra y el derecho blanco: el robot est치 desviado a la derecha, necesita girar a la izquierda.</li>
                            <li>Si el sensor derecho detecta la l칤nea negra y el izquierdo blanco: el robot est치 desviado a la izquierda, necesita girar a la derecha.</li>
                            <li>Si ambos sensores (o el central, si se usan m치s) detectan la l칤nea: el robot est치 centrado, debe avanzar.</li>
                            <li>Si ning칰n sensor detecta la l칤nea: el robot se ha salido (o es una secci칩n sin l칤nea), puede detenerse o implementar una rutina de b칰squeda.</li>
                        </ul>
                    </li>
                    <li><strong>Controlar los Motores:</strong> Enviar las se침ales adecuadas al controlador de motores para que las ruedas giren a la velocidad y direcci칩n deseadas para ejecutar la correcci칩n.</li>
                </ol>
                <p>En el editor de c칩digo del simulador podr치s usar un lenguaje parecido al usado en Arduino, pero simplificado.</p>
            </div>
        </div>

        <!-- Simulation Tab -->
        <div id="simulation" class="tab-content">
            <div class="simulation-layout simulation-double-column">
                <div class="simulation-view">
                    <canvas id="simulationDisplayCanvas" width="700" height="500"></canvas>
                    <div class="simulation-controls">
                        <button id="startSimButton">Iniciar</button>
                        <button id="stopSimButton" disabled>Detener</button>
                        <button id="resetSimButton">Reiniciar Sim</button>
                        <button id="placeStartLineSimButton">Ubicar L칤nea de Comienzo</button>
                    </div>
                </div>
                <div class="simulation-parameters">
                    <details id="simParamsDetails">
                        <summary><h3 style="display:inline; font-size:1.1em; font-weight:600; margin:0;">Par치metros de Simulaci칩n</h3></summary>
                        <label for="timeStep">Paso de Tiempo (s):</label>
                        <input type="number" id="timeStep" value="0.01" step="0.001" min="0.001">
                        <label for="maxRobotSpeed">Vel. M치x. Robot (m/s):</label>
                        <input type="number" id="maxRobotSpeed" value="1.0" step="0.05" min="0.05">
                        <label for="motorEfficiency">Eficiencia Motor (0-1):</label>
                        <input type="number" id="motorEfficiency" value="0.85" step="0.01" min="0.1" max="1">
                        <label for="motorResponse">Respuesta Motor (0-1):</label>
                        <input type="number" id="motorResponse" value="0.1" step="0.01" min="0.01" max="1">
                        <label for="sensorNoise">Ruido Sensor (0-1):</label>
                        <input type="number" id="sensorNoise" value="0.0" step="0.01" min="0" max="1">
                        <label for="movementPerturb">Perturb. Movim. (0-1):</label>
                        <input type="number" id="movementPerturb" value="0.0" step="0.01" min="0" max="1">
                        <label for="motorDeadband">PWM Banda Muerta Motor:</label>
                        <input type="number" id="motorDeadband" value="40" step="1" min="0">
                        <label for="lineThreshold">Umbral L칤nea (0-255):</label>
                        <input type="number" id="lineThreshold" value="100" step="1" min="0" max="255">
                        <button id="applySimParamsButton">Aplicar Par치metros</button>
                    </details>
                </div>
                <div class="sim-monitor-column">
                    <h4>Monitor Serial</h4>
                    <pre id="serialMonitorOutput"></pre>
                    <button id="clearSerialButton" type="button">Limpiar Serial</button>
                    <h4>Cron칩metro</h4>
                    <pre id="lapTimerOutput">Vueltas: 0 | Mejor: --:--:--- | Actual: --:--:---</pre>
                </div>
            </div>
        </div>

        <!-- Code Editor Tab -->
        <div id="code-editor" class="tab-content">
            <div class="code-editor-layout">
                <div class="code-editor-container">
                    <div class="code-template-selector">
                        <label for="codeTemplate">Seleccionar tipo de control:</label>
                        <select id="codeTemplate" class="template-select">
                            <option value="custom">C칩digo Personalizado</option>
                            <option value="onoff" selected>Control On/Off Simple</option>
                            <option value="continuous-turn">Control On/Off con Giro Continuo</option>
                            <option value="proportional">Control Proporcional</option>
                            <option value="pid">Control PID Completo</option>
                        </select>
                    </div>
                    <div id="monacoContainer" style="height: 600px; border: 1px solid #ccc;"></div>
                    <div class="editor-help">
                        <h2>Editor de C칩digo (Arduino-like JavaScript)</h2>
                        <h3>쮺칩mo usar este editor?</h3>
                        <p>춰Aqu칤 puedes escribir el c칩digo que controla tu robot! Cambia el tipo de control arriba, edita el c칩digo y mira c칩mo responde el robot en la simulaci칩n. Si te equivocas, no pasa nada, puedes volver a intentarlo.</p>
                        <h4>Funciones que puedes usar:</h4>
                        <ul>
                            <li><strong>setup()</strong>: Se ejecuta una vez al comenzar. Aqu칤 preparas todo.</li>
                            <li><strong>loop()</strong>: Se repite muchas veces. Aqu칤 va la l칩gica principal.</li>
                            <li><strong>digitalRead(pin)</strong>: Lee si un sensor est치 sobre la l칤nea (0) o fuera (1).</li>
                            <li><strong>analogWrite(pin, valor)</strong>: Cambia la velocidad de los motores (0 a 255).</li>
                            <li><strong>(...)</strong> y <strong>Serial.println(...)</strong>: Muestra mensajes en el Monitor Serial.</li>
                            <li><strong>delay(ms)</strong>: Espera el tiempo que le digas (en milisegundos).</li>
                        </ul>
                        <p>춰Divi칠rtete probando y aprendiendo c칩mo hacer que tu robot siga la l칤nea!</p>
                    </div>
                </div>
                <div class="serial-and-explanation">
                    <div class="code-explanation">
                        <h3>Gu칤a del C칩digo</h3>
                        <p>Este editor te permite modificar el comportamiento del robot seguidor de l칤nea. El c칩digo simula un programa de Arduino y contiene dos funciones principales:</p>
                        <h4>Funciones Principales:</h4>
                        <ul>
                            <li><strong>setup()</strong>: Se ejecuta una vez al inicio. Configura los pines y la comunicaci칩n serial.</li>
                            <li><strong>loop()</strong>: Se ejecuta continuamente. Lee los sensores y controla los motores.</li>
                        </ul>
                        <h4>Pines y Variables Importantes:</h4>
                        <ul>
                            <li><strong>Sensores (digitalRead)</strong>: LEFT_SENSOR_PIN(2), CENTER_SENSOR_PIN(3), RIGHT_SENSOR_PIN(4)</li>
                            <li><strong>Motores (analogWrite)</strong>: MOTOR_LEFT_PWM(6), MOTOR_RIGHT_PWM(5)</li>
                            <li>Los sensores retornan 0 cuando est치n sobre la l칤nea negra y 1 cuando est치n fuera</li>
                            <li>Los motores aceptan valores entre 0 (parado) y 255 (m치xima velocidad)</li>
                        </ul>
                        <h4>Tipos de Control Disponibles:</h4>
                        <ul>
                            <li><strong>On/Off</strong>: Control b치sico que solo gira a la izquierda o derecha seg칰n el sensor activado.</li>
                            <li><strong>Proporcional</strong>: Ajusta la velocidad de giro seg칰n qu칠 tan lejos est치 de la l칤nea.</li>
                            <li><strong>PID</strong>: Control avanzado que considera el error actual (P), acumulado (I) y su variaci칩n (D).</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Robot Editor Tab -->
        <div id="robot-editor" class="tab-content">
            <div class="robot-editor-layout">
                <div class="robot-preview">
                    <h3>Vista Previa del Robot</h3>
                    <canvas id="robotPreviewCanvas" width="300" height="300"></canvas>
                    <div class="robot-parts-palette">
                        <h4>Partes Decorativas</h4>
                        <div id="robotPartsPalette">
                            <!-- Parts will be loaded here by JS -->
                        </div>
                    </div>
                    <div class="robot-editor-help" style="margin-top:1em; font-size:0.95em; color:#234e70; background:#f8f9fa; border-radius:8px; padding:0.8em 1em;">
                        <strong>쮺칩mo usar el editor de robot?</strong><br>
                        <ul style="margin:0.5em 0 0 1.2em; padding:0;">
                            <li>Haz <b>click</b> en una pieza y luego <b>arr치strala</b> al robot para ubicarla.</li>
                            <li><b>Click y arrastrar</b> sobre una pieza ya colocada para moverla.</li>
                            <li><b>Doble click</b> sobre una pieza para rotarla.</li>
                            <li>Activa <b>Modo Borrar</b> y haz <b>doble click</b> en una pieza para eliminarla.</li>
                            <li>Haz click en <b>Aplicar Geometr칤a y Reiniciar Sim</b> para cargar el robot en el simulador.</li>
                            <li>Usa <b>Guardar Robot</b> para descargar tu dise침o y <b>Cargar Robot</b> para restaurarlo.</li>
                            <li>Puedes cargar un robot prearmado desde la lista desplegable.</li>
                        </ul>
                    </div>
                </div>
                <div class="robot-parameters">
                    <h3>Geometr칤a del Robot (en metros)</h3>
                    <label for="robotWidth">
                        Ancho (dist. ruedas) (m):
                        <input type="number" id="robotWidth" value="0.10" step="0.01" min="0.02">
                    </label>
                    
                    <label for="sensorOffset">
                        Offset Sensores Delante (m):
                        <input type="number" id="sensorOffset" value="0.05" step="0.005" min="0">
                    </label>
                    
                    <label for="sensorSpread">
                        Separaci칩n Sensores Laterales (m):
                        <input type="number" id="sensorSpread" value="0.03" step="0.005" min="0">
                    </label>
                    
                    <label for="sensorDiameter">
                        Di치metro Sensor (m):
                        <input type="number" id="sensorDiameter" value="0.005" step="0.001" min="0.001">
                    </label>
                    
                    <button id="applyRobotGeometryButton">Aplicar Geometr칤a y Reiniciar Sim</button>
                    <button id="resetRobotGeometryButton">Geometr칤a por Defecto</button>
                    <div style="margin-top: 1em; display: flex; gap: 0.5em; align-items: center;">
                        <button id="saveRobotButton" style="flex:1; text-align:center;">Guardar Robot</button>
                        <label for="loadRobotInput" class="file-input-label" style="flex:1; text-align:center;">Cargar Robot (.json)</label>
                        <input type="file" id="loadRobotInput" accept=".json" style="display:none;">
                    </div>
                    <div style="margin-top: 1em;">
                        <label for="robotSelectionDropdown">Seleccionar Robot Predefinido:</label>
                        <select id="robotSelectionDropdown" style="width: 100%; margin-top: 0.5em;">
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Track Editor Tab -->
        <div id="track-editor" class="tab-content">
            <div class="track-editor-layout">
                <div class="track-editor-grid">
                    <canvas id="trackEditorCanvas"></canvas> <!-- Size set by JS -->
                </div>
                <div class="track-editor-controls">
                    <h3>Controles de Pista</h3>
                    <label for="trackGridSize">Tama침o Grid:</label>
                    <select id="trackGridSize">
                        <option value="3x3">3x3</option>
                        <option value="4x4" selected>4x4</option>
                        <option value="5x5">5x5</option>
                    </select>
                    <button id="generateRandomTrack">Generar Pista Aleatoria (Loop)</button>
                    <button id="exportTrackToSimulator">Usar en Simulaci칩n</button>
                    <button id="clearTrackButton" class="danger" style="margin-top:0.5em;">Limpiar Pista</button>
                    <hr>
                    <div style="display: flex; gap: 0.5em; align-items: center; margin-top: 1em;">
                        <button id="saveTrackDesignButton" style="flex:1; text-align:center;">Guardar Dise침o</button>
                        <label for="loadTrackDesignInput" class="file-input-label" style="flex:1; text-align:center;">Cargar Dise침o (.json)</label>
                        <input type="file" id="loadTrackDesignInput" accept=".json,.trackdesign" style="display:none;">
                    </div>
                </div>
                <div class="track-parts-palette-container">
                    <h3>Paleta de Piezas</h3>
                    <div id="trackPartsPalette">
                        <!-- Piezas se cargar치n aqu칤 por JS -->
                    </div>
                    <p class="small-text">Click para Ubicar, Doble-Click para rotar.</p>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>Simulador Avanzado de Seguidor de L칤nea - 2025. Ing. Luis Fernando Corado</p>
    </footer>

    <script type="module" src="js/main.js"></script>
</body>
</html>