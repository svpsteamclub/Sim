<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arduino Line Follower Advanced Simulator</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.47.0/min/vs/loader.min.js"></script>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1976d2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="assets/Logo%20guaroduino.png">
</head>
<body>
    <header>
        <div class="header-flex">
            <div class="header-title-nav">
                <h1>Simulador de Seguidor de Lineas</h1>
                <nav class="tabs">
                    <button class="tab-button active" data-tab="introduccion">Introducci칩n</button>
                    <button class="tab-button" data-tab="simulation">Simulaci칩n</button>
                    <button class="tab-button" data-tab="code-editor">Editor de C칩digo</button>
                    <button class="tab-button" data-tab="robot-editor">Editor de Robot</button>
                    <button class="tab-button" data-tab="track-editor">Editor de Pista</button>
                </nav>
            </div>
            <img src="assets/Logo%20guaroduino.png" alt="Logo Guaroduino" class="header-logo">
        </div>
    </header>

    <main>
        <!-- Introducci칩n Tab -->
        <div id="introduccion" class="tab-content active">
            <div style="max-width:1000px;margin:2em auto 0 auto;text-align:justify;">
                <h2>Introducci칩n</h2>
                <h1>游뱄 Explorando el Mundo de los Robots Seguidores de L칤neas y Nuestro Simulador</h1>
                <p>춰Bienvenido a la secci칩n de aprendizaje de nuestro simulador de robots seguidores de l칤neas! Aqu칤 descubrir치s qu칠 son estos fascinantes robots, c칩mo funcionan, c칩mo se programan con Arduino y, lo m치s importante, c칩mo puedes usar nuestro simulador para dise침ar, probar y optimizar tus propios robots virtuales.</p>
                <hr>
                <h2>쯈u칠 es un Robot Seguidor de L칤neas?</h2>
                <p>Un <strong>robot seguidor de l칤neas</strong> es un veh칤culo aut칩nomo dise침ado para detectar y seguir una l칤nea dibujada en el suelo. Esta l칤nea suele ser de un color que contrasta fuertemente con la superficie (por ejemplo, una l칤nea negra sobre un fondo blanco, o viceversa). Estos robots son muy populares en el 치mbito educativo y en competencias de rob칩tica, ya que introducen conceptos fundamentales de sensado, l칩gica de control y actuaci칩n.</p>
                <p>Su funcionamiento se basa en un bucle constante de:</p>
                <ol>
                    <li><strong>Sensar:</strong> Detectar la posici칩n de la l칤nea con respecto al robot.</li>
                    <li><strong>Decidir:</strong> Aplicar una l칩gica de control para determinar c칩mo debe moverse el robot.</li>
                    <li><strong>Actuar:</strong> Mover los motores para corregir la trayectoria y mantenerse sobre la l칤nea.</li>
                </ol>
                <hr>
                <h2>Componentes T칤picos de un Robot Seguidor de L칤neas F칤sico</h2>
                <p>Aunque nuestro simulador es virtual, es 칰til conocer los componentes de un robot real para entender mejor su funcionamiento:</p>
                <ul>
                    <li><strong>Chasis:</strong> Es la estructura f칤sica del robot que sostiene todos los dem치s componentes. Su dise침o (material, forma, tama침o) puede influir en el rendimiento.</li>
                    <li><strong>Microcontrolador (Arduino):</strong> Act칰a como el "cerebro" del robot. Una placa Arduino (como Arduino UNO) es com칰nmente utilizada debido a su facilidad de programaci칩n y versatilidad. Recibe informaci칩n de los sensores y env칤a comandos a los motores.</li>
                    <li><strong>Sensores Infrarrojos (IR):</strong> Son los "ojos" del robot. T칤picamente se usan pares de emisor-detector infrarrojo (como el CNY70 o m칩dulos TCRT5000). El emisor env칤a luz IR y el detector mide cu치nta luz se refleja. Una superficie blanca refleja m치s luz IR que una negra. Con varios sensores, el robot puede saber si est치 centrado, a la izquierda o a la derecha de la l칤nea.</li>
                    <li><strong>Motores y Ruedas:</strong> Proporcionan el movimiento. Generalmente se usan dos motores de corriente continua (DC) con ruedas, permitiendo giros diferenciales (una rueda gira m치s r치pido que la otra, o en sentido contrario, para cambiar de direcci칩n).</li>
                    <li><strong>Controlador de Motores (Puente H):</strong> Un microcontrolador como Arduino no puede suministrar directamente la corriente que necesitan los motores. Un controlador de motores (por ejemplo, el L293D o L298N) act칰a como un intermediario, permitiendo al Arduino controlar la velocidad y direcci칩n de los motores.</li>
                    <li><strong>Fuente de Alimentaci칩n:</strong> Bater칤as o un paquete de pilas que proporcionan la energ칤a necesaria para todos los componentes electr칩nicos.</li>
                    <li><strong>Rueda Loca o Deslizador:</strong> Un tercer punto de apoyo (adem치s de las dos ruedas motrices) que permite al robot girar con facilidad.</li>
                </ul>
                <hr>
                <h2>Programaci칩n con Arduino IDE</h2>
                <p>Los robots seguidores de l칤neas basados en Arduino se programan utilizando el <strong>Arduino IDE (Entorno de Desarrollo Integrado)</strong>. El lenguaje de programaci칩n es una variante de C/C++.</p>
                <p>La l칩gica b치sica de control en el c칩digo de Arduino suele seguir estos pasos dentro de la funci칩n <code>loop()</code> (que se ejecuta continuamente):</p>
                <ol>
                    <li><strong>Leer los Sensores:</strong> Obtener los valores digitales (NEGRO/BLANCO) o anal칩gicos (niveles de reflexi칩n) de los sensores de l칤nea.</li>
                    <li><strong>Tomar Decisiones:</strong> Bas치ndose en las lecturas de los sensores, determinar la posici칩n del robot respecto a la l칤nea:
                        <ul>
                            <li>Si el sensor izquierdo detecta la l칤nea negra y el derecho blanco: el robot est치 desviado a la derecha, necesita girar a la izquierda.</li>
                            <li>Si el sensor derecho detecta la l칤nea negra y el izquierdo blanco: el robot est치 desviado a la izquierda, necesita girar a la derecha.</li>
                            <li>Si ambos sensores (o el central, si se usan m치s) detectan la l칤nea: el robot est치 centrado, debe avanzar.</li>
                            <li>Si ning칰n sensor detecta la l칤nea: el robot se ha salido (o es una secci칩n sin l칤nea), puede detenerse o implementar una rutina de b칰squeda.</li>
                        </ul>
                    </li>
                    <li><strong>Controlar los Motores:</strong> Enviar las se침ales adecuadas al controlador de motores para que las ruedas giren a la velocidad y direcci칩n deseadas para ejecutar la correcci칩n.</li>
                </ol>
                <p>En el editor de c칩digo del simulador podr치s usar un lenguaje parecido al usado en Arduino, pero simplificado.</p>
                <h2>Explorando con Nuestro Simulador de Robot Seguidor de L칤neas 游</h2>
                <p>춰Bienvenido a nuestro simulador de robot seguidor de l칤neas, accesible en <a href="https://svpsteamclub.github.io/Sim/" target="_blank">svpsteamclub.github.io/Sim/</a>! Esta herramienta te permite dise침ar, programar y probar virtualmente tus robots seguidores de l칤neas antes de construirlos f칤sicamente, o simplemente para aprender y experimentar con diferentes configuraciones y algoritmos sin necesidad de hardware.</p>

                <h3>쮺칩mo se usa el simulador?</h3>
                <p>Nuestro simulador est치 dise침ado para ser intuitivo. Generalmente, te permitir치:</p>
                <ul>
                    <li><strong>Cargar o Dise침ar Pistas:</strong> Podr치s seleccionar pistas predefinidas o, dependiendo de las funcionalidades, crear tus propios recorridos con diferentes niveles de complejidad (curvas, cruces, etc.).</li>
                    <li><strong>Configurar el Robot Virtual:</strong> Podr치s ajustar par치metros clave del robot, como el n칰mero de sensores, su posici칩n relativa, la velocidad base de los motores, y otras caracter칤sticas que afectan su comportamiento. 춰Aqu칤 es donde entra en juego la evaluaci칩n de geometr칤as!</li>
                    <li><strong>Introducir tu C칩digo de Control:</strong> El simulador cuenta con un editor donde podr치s escribir o pegar tu c칩digo de control, similar al que usar칤as en el Arduino IDE. El simulador interpretar치 este c칩digo para dirigir al robot virtual.</li>
                    <li><strong>Ejecutar la Simulaci칩n:</strong> Una vez configurada la pista, el robot y el c칩digo, podr치s iniciar la simulaci칩n. Ver치s en tiempo real c칩mo tu robot virtual intenta seguir la l칤nea en la pista dise침ada.</li>
                    <li><strong>Observar y Depurar:</strong> Podr치s ver el comportamiento del robot, las lecturas de sus sensores virtuales y, a menudo, mensajes de depuraci칩n que te ayudar치n a entender qu칠 est치 haciendo tu c칩digo y por qu칠.</li>
                    <li><strong>Reiniciar y Modificar:</strong> Si el robot no se comporta como esperas, puedes detener la simulaci칩n, modificar tu c칩digo o la configuraci칩n del robot, y volver a intentarlo r치pidamente.</li>
                </ul>

                <hr>

                <h2>Evaluando Distintas Geometr칤as de Robot y C칩digos de Control con el Simulador</h2>
                <p>El verdadero poder de un simulador como el nuestro reside en su capacidad para permitirte <strong>experimentar de forma r치pida, econ칩mica y eficiente</strong>. Puedes probar ideas que ser칤an costosas o llevar칤an mucho tiempo con un robot f칤sico.</p>

                <h3>Evaluaci칩n de Geometr칤as del Robot 游늻</h3>
                <p>La "geometr칤a" de tu robot se refiere a la disposici칩n f칤sica de sus componentes, especialmente aquellos que influyen en c칩mo detecta la l칤nea y c칩mo se mueve. Con el simulador, puedes investigar c칩mo afectan estos cambios:</p>
                <ul>
                    <li>
                        <strong>Posici칩n y Separaci칩n de los Sensores:</strong>
                        <ul>
                            <li>쯈u칠 tan separados deben estar los sensores entre s칤? Sensores muy juntos pueden tener dificultades en curvas amplias o al detectar desviaciones sutiles. Sensores muy separados pueden hacer que el robot "dude" o reaccione tarde.</li>
                            <li>쯈u칠 tan adelante del eje de las ruedas motrices deben estar los sensores? Una mayor distancia puede dar m치s tiempo para reaccionar y hacer al robot m치s "previsor", pero tambi칠n puede amplificar las oscilaciones si el control no es adecuado. Una menor distancia puede requerir reacciones m치s r치pidas.</li>
                        </ul>
                    </li>
                    <li>
                        <strong>Distancia entre Ruedas (Batalla y Ancho de V칤a):</strong> Aunque el simulador modele un robot con dimensiones espec칤ficas, entender c칩mo el tama침o y la proporci칩n afectan la maniobrabilidad es clave. Un robot m치s ancho podr칤a ser m치s estable pero menos 치gil en curvas cerradas.
                    </li>
                    <li>
                        <strong>N칰mero de Sensores:</strong> 쮼s mejor usar 2, 3, 5 o m치s sensores? M치s sensores pueden proporcionar informaci칩n m치s detallada sobre la posici칩n de la l칤nea, permitiendo algoritmos de control m치s suaves y precisos, especialmente en intersecciones o l칤neas discontinuas.
                    </li>
                </ul>
                <p><strong>쮺칩mo usar el simulador para evaluar geometr칤as?</strong></p>
                <ol>
                    <li><strong>Identifica los Par치metros Configurables:</strong> Revisa en la interfaz del simulador qu칠 aspectos de la geometr칤a del robot puedes modificar (ej. distancia entre sensores, offset frontal de los sensores).</li>
                    <li><strong>Define un Escenario de Prueba:</strong> Usa la misma pista y el mismo c칩digo de control b치sico.</li>
                    <li><strong>Modifica un Par치metro a la Vez:</strong> Cambia una caracter칤stica geom칠trica y ejecuta la simulaci칩n.</li>
                    <li><strong>Observa y Compara:</strong> 쮼l robot sigue la l칤nea mejor o peor? 쮼s m치s estable? 쮺ompleta la pista m치s r치pido o se sale? Anota tus observaciones.</li>
                    <li><strong>Itera:</strong> Prueba diferentes configuraciones hasta encontrar una que consideres 칩ptima para el tipo de pista o el rendimiento que buscas.</li>
                </ol>

                <h3>Evaluaci칩n de C칩digos de Control (Algoritmos) 游눹</h3>
                <p>El c칩digo de control es el "alma" de tu robot. El simulador es una plataforma ideal para probar desde l칩gicas simples hasta algoritmos m치s avanzados sin arriesgar un robot f칤sico o perder tiempo subiendo c칩digo repetidamente.</p>
                <ul>
                    <li>
                        <strong>Control B치sico On-Off (o Bang-Bang):</strong>
                        <p>Es el m치s simple: si el sensor izquierdo est치 en la l칤nea, gira fuerte a la izquierda; si el derecho, gira fuerte a la derecha. Esto suele producir un movimiento oscilante ("zigzagueante") sobre la l칤nea.</p>
                    </li>
                    <li>
                        <strong>Control Proporcional (P):</strong>
                        <p>La correcci칩n es proporcional al error (qu칠 tan lejos est치 el robot del centro de la l칤nea). Si est치 un poco desviado, corrige un poco. Si est치 muy desviado, corrige m치s. Esto suaviza el movimiento en comparaci칩n con el control on-off. Necesitar치s ajustar una constante de proporcionalidad (Kp).</p>
                        <p><code>correccion = Kp * error;</code></p>
                        <p><code>velocidadMotorIzq = velocidadBase - correccion;</code></p>
                        <p><code>velocidadMotorDer = velocidadBase + correccion;</code></p>
                    </li>
                    <li>
                        <strong>Control Proporcional-Derivativo (PD):</strong>
                        <p>A침ade un componente derivativo (Kd) que considera la velocidad con la que cambia el error. Esto ayuda a "anticipar" y amortiguar las oscilaciones, haciendo que el robot sea m치s estable y responda mejor a cambios r치pidos en la l칤nea (como la entrada a una curva).</p>
                        <p><code>derivativo = Kd * (error - errorAnterior);</code></p>
                        <p><code>correccion = Kp * error + derivativo;</code></p>
                    </li>
                    <li>
                        <strong>Control Proporcional-Integral-Derivativo (PID):</strong>
                        <p>Es el m치s completo y a menudo el m치s eficiente, pero tambi칠n el m치s complejo de "sintonizar" (ajustar las constantes Kp, Ki, Kd). El componente integral (Ki) ayuda a corregir errores acumulados a lo largo del tiempo, permitiendo que el robot se centre mejor en la l칤nea incluso con perturbaciones o irregularidades.</p>
                        <p><code>integral = integral + Ki * error;</code></p>
                        <p><code>correccion = Kp * error + integral + Kd * (error - errorAnterior);</code></p>
                    </li>
                </ul>
                <p><strong>쮺칩mo usar el simulador para evaluar c칩digos de control?</strong></p>
                <ol>
                    <li><strong>Implementa el Algoritmo:</strong> Escribe el c칩digo para la l칩gica de control que quieres probar en el editor del simulador.</li>
                    <li><strong>Ajusta los Par치metros (Sintonizaci칩n):</strong> Para controles P, PD o PID, las constantes (Kp, Ki, Kd) son cruciales. El simulador te permite cambiarlas r치pidamente en el c칩digo y ver el efecto inmediato sin necesidad de recompilar y cargar en un robot f칤sico. Empieza con valores peque침os y aj칰stalos gradualmente.</li>
                    <li><strong>Prueba en Diversas Pistas:</strong> Un c칩digo que funciona bien en una pista simple con curvas suaves podr칤a fallar en una pista compleja con 치ngulos cerrados, cruces o interrupciones. El simulador te permite probar la robustez de tu algoritmo en diferentes escenarios.</li>
                    <li><strong>Analiza la Trayectoria y la Estabilidad:</strong> Observa si el robot sigue la l칤nea suavemente, si oscila mucho, si se sale en las curvas, o si es demasiado lento en las rectas o demasiado agresivo en sus correcciones. Busca un equilibrio.</li>
                    <li><strong>Utiliza Herramientas de Depuraci칩n:</strong> Si el simulador ofrece visualizaci칩n de variables o gr치ficos (por ejemplo, del error o de la salida de los sensores), 칰salos para entender mejor el comportamiento de tu algoritmo.</li>
                </ol>
                <p>춰La clave es la <strong>experimentaci칩n</strong>! No tengas miedo de probar diferentes enfoques, ajustar valores y ver qu칠 sucede. El simulador es tu laboratorio virtual para convertirte en un experto en robots seguidores de l칤neas.</p>
                <p>춰Divi칠rtete aprendiendo y optimizando tus robots en <a href="https://svpsteamclub.github.io/Sim/" target="_blank">nuestro simulador</a>!</p>
            </div>
        </div>

        <!-- Simulation Tab -->
        <div id="simulation" class="tab-content">
            <div class="simulation-layout simulation-double-column">
                <div class="simulation-view">
                    <canvas id="simulationDisplayCanvas" width="700" height="500"></canvas>
                    <div class="simulation-controls">
                        <button id="startSimButton">Iniciar</button>
                        <button id="stopSimButton" disabled>Detener</button>
                        <button id="resetSimButton">Reiniciar Sim</button>
                        <button id="placeStartLineSimButton">Ubicar L칤nea de Comienzo</button>
                    </div>
                </div>
                <div class="simulation-parameters">
                    <details id="simParamsDetails">
                        <summary><h3 style="display:inline; font-size:1.1em; font-weight:600; margin:0;">Par치metros de Simulaci칩n</h3></summary>
                        <label for="timeStep">Paso de Tiempo (s):</label>
                        <input type="number" id="timeStep" value="0.01" step="0.001" min="0.001">
                        <label for="maxRobotSpeed">Vel. M치x. Robot (m/s):</label>
                        <input type="number" id="maxRobotSpeed" value="1.0" step="0.05" min="0.05">
                        <label for="motorEfficiency">Eficiencia Motor (0-1):</label>
                        <input type="number" id="motorEfficiency" value="0.85" step="0.01" min="0.1" max="1">
                        <label for="motorResponse">Respuesta Motor (0-1):</label>
                        <input type="number" id="motorResponse" value="0.1" step="0.01" min="0.01" max="1">
                        <label for="sensorNoise">Ruido Sensor (0-1):</label>
                        <input type="number" id="sensorNoise" value="0.0" step="0.01" min="0" max="1">
                        <label for="movementPerturb">Perturb. Movim. (0-1):</label>
                        <input type="number" id="movementPerturb" value="0.0" step="0.01" min="0" max="1">
                        <label for="motorDeadband">PWM Banda Muerta Motor:</label>
                        <input type="number" id="motorDeadband" value="40" step="1" min="0">
                        <label for="lineThreshold">Umbral L칤nea (0-255):</label>
                        <input type="number" id="lineThreshold" value="100" step="1" min="0" max="255">
                        <button id="applySimParamsButton">Aplicar Par치metros</button>
                    </details>
                </div>
                <div class="sim-monitor-column">
                    <h4>Monitor Serial</h4>
                    <pre id="serialMonitorOutput"></pre>
                    <button id="clearSerialButton" type="button">Limpiar Serial</button>
                    <h4>Cron칩metro</h4>
                    <pre id="lapTimerOutput">Vueltas: 0 | Mejor: --:--:--- | Actual: --:--:---</pre>
                </div>
            </div>
        </div>

        <!-- Code Editor Tab -->
        <div id="code-editor" class="tab-content">
            <div class="code-editor-layout">
                <div class="code-editor-container">
                    <div class="code-template-selector">
                        <label for="codeTemplate">Seleccionar tipo de control:</label>
                        <select id="codeTemplate" class="template-select">
                            <option value="custom">C칩digo Personalizado</option>
                            <option value="onoff" selected>Control On/Off Simple</option>
                            <option value="continuous-turn">Control On/Off con Giro Continuo</option>
                        </select>
                    </div>
                    <div id="monacoContainer" style="height: 600px; border: 1px solid #ccc;"></div>
                    <div style="display:flex; gap:0.5em; margin:1em 0;">
                        <button id="downloadCodeButton" style="flex:1;">Descargar C칩digo</button>
                        <label for="uploadCodeInput" class="file-input-label" style="flex:1; text-align:center; cursor:pointer;">Cargar C칩digo
                            <input type="file" id="uploadCodeInput" accept=".txt,.js" style="display:none;">
                        </label>
                    </div>
                    <div class="editor-help">
                        <h2>Editor de C칩digo (Arduino-like JavaScript)</h2>
                        <h3>쮺칩mo usar este editor?</h3>
                        <p>춰Aqu칤 puedes escribir el c칩digo que controla tu robot! Cambia el tipo de control arriba, edita el c칩digo y mira c칩mo responde el robot en la simulaci칩n. Si te equivocas, no pasa nada, puedes volver a intentarlo.</p>
                        <h4>Funciones de Control Disponibles</h4>
                        <ul>
                            <li><strong>On/Off Simple:</strong> Gira completamente a la izquierda o derecha seg칰n el sensor activado. Ejemplo:
                                <pre style="background:#f8f9fa; border-radius:6px; padding:0.5em;">if (digitalRead(LEFT_SENSOR_PIN) == 0) {
    // Gira a la izquierda
} else if (digitalRead(RIGHT_SENSOR_PIN) == 0) {
    // Gira a la derecha
} else {
    // Avanza recto
}</pre>
                            </li>
                            <li><strong>On/Off con Giro Continuo:</strong> Si el robot pierde la l칤nea, sigue girando en la 칰ltima direcci칩n usada. 칔til para curvas cerradas.</li>
                            <li><strong>Personalizado:</strong> Escribe tu propia l칩gica de control usando las funciones disponibles.</li>
                        </ul>
                        <h4>쮺칩mo referenciar los sensores en tu c칩digo?</h4>
                        <ul>
                            <li><b>Para 2 sensores:</b> <code>LEFT_SENSOR_PIN</code> (2), <code>RIGHT_SENSOR_PIN</code> (3)</li>
                            <li><b>Para 3 sensores:</b> <code>LEFT_SENSOR_PIN</code> (2), <code>CENTER_SENSOR_PIN</code> (3), <code>RIGHT_SENSOR_PIN</code> (4)</li>
                            <li><b>Para 4 sensores:</b> <code>FAR_LEFT_SENSOR_PIN</code> (2), <code>LEFT_SENSOR_PIN</code> (3), <code>RIGHT_SENSOR_PIN</code> (4), <code>FAR_RIGHT_SENSOR_PIN</code> (5)</li>
                            <li><b>Para 5 sensores:</b> <code>FAR_LEFT_SENSOR_PIN</code> (2), <code>LEFT_SENSOR_PIN</code> (3), <code>CENTER_SENSOR_PIN</code> (4), <code>RIGHT_SENSOR_PIN</code> (5), <code>FAR_RIGHT_SENSOR_PIN</code> (6)</li>
                        </ul>
                        <p>Usa solo los pines que correspondan a la cantidad de sensores de tu robot. Por ejemplo, si tienes 4 sensores, puedes leerlos as칤:</p>
                        <pre style="background:#f8f9fa; border-radius:6px; padding:0.5em;">let sFL = digitalRead(FAR_LEFT_SENSOR_PIN);
let sL = digitalRead(LEFT_SENSOR_PIN);
let sR = digitalRead(RIGHT_SENSOR_PIN);
let sFR = digitalRead(FAR_RIGHT_SENSOR_PIN);</pre>
                        <p>Si tienes 2 o 3 sensores, simplemente ignora los que no existen. El simulador asigna los pines autom치ticamente seg칰n la cantidad de sensores seleccionada en el editor de robot.</p>
                        <h4>Funciones que puedes usar:</h4>
                        <ul>
                            <li><strong>setup()</strong>: Se ejecuta una vez al comenzar. Aqu칤 preparas todo.</li>
                            <li><strong>loop()</strong>: Se repite muchas veces. Aqu칤 va la l칩gica principal.</li>
                            <li><strong>digitalRead(pin)</strong>: Lee si un sensor est치 sobre la l칤nea (0) o fuera (1).</li>
                            <li><strong>analogWrite(pin, valor)</strong>: Cambia la velocidad de los motores (0 a 255).</li>
                            <li><strong>(...)</strong> y <strong>Serial.println(...)</strong>: Muestra mensajes en el Monitor Serial.</li>
                            <li><strong>delay(ms)</strong>: Espera el tiempo que le digas (en milisegundos).</li>
                        </ul>
                        <p>춰Divi칠rtete probando y aprendiendo c칩mo hacer que tu robot siga la l칤nea!</p>
                    </div>
                </div>
                <div class="serial-and-explanation">
                    <div class="code-explanation">
                        <h3>Gu칤a del C칩digo</h3>
                        <p>Este editor te permite modificar el comportamiento del robot seguidor de l칤nea. El c칩digo simula un programa de Arduino y contiene dos funciones principales:</p>
                        <h4>Funciones Principales:</h4>
                        <ul>
                            <li><strong>setup()</strong>: Se ejecuta una vez al inicio. Configura los pines y la comunicaci칩n serial.</li>
                            <li><strong>loop()</strong>: Se ejecuta continuamente. Lee los sensores y controla los motores.</li>
                        </ul>
                        <h4>Pines y Variables Importantes:</h4>
                        <ul>
                            <li><strong>Sensores (digitalRead)</strong>: LEFT_SENSOR_PIN(2), CENTER_SENSOR_PIN(3), RIGHT_SENSOR_PIN(4)</li>
                            <li><strong>Motores (analogWrite)</strong>: MOTOR_LEFT_PWM(6), MOTOR_RIGHT_PWM(5)</li>
                            <li>Los sensores retornan 0 cuando est치n sobre la l칤nea negra y 1 cuando est치n fuera</li>
                            <li>Los motores aceptan valores entre 0 (parado) y 255 (m치xima velocidad)</li>
                        </ul>
                        <h4>Tipos de Control Disponibles:</h4>
                        <ul>
                            <li><strong>On/Off</strong>: Control b치sico que solo gira a la izquierda o derecha seg칰n el sensor activado.</li>
                            <li><strong>Proporcional</strong>: Ajusta la velocidad de giro seg칰n qu칠 tan lejos est치 de la l칤nea.</li>
                            <li><strong>PID</strong>: Control avanzado que considera el error actual (P), acumulado (I) y su variaci칩n (D).</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Robot Editor Tab -->
        <div id="robot-editor" class="tab-content">
            <div class="robot-editor-layout">
                <div class="robot-preview">
                    <h3>Vista Previa del Robot</h3>
                    <canvas id="robotPreviewCanvas" width="300" height="300"></canvas>
                    <div class="robot-parts-palette">
                        <h4>Partes Decorativas</h4>
                        <div id="robotPartsPalette">
                            <!-- Parts will be loaded here by JS -->
                        </div>
                    </div>
                    <div class="robot-editor-help" style="margin-top:1em; font-size:0.95em; color:#234e70; background:#f8f9fa; border-radius:8px; padding:0.8em 1em;">
                        <strong>쮺칩mo usar el editor de robot?</strong><br>
                        <ul style="margin:0.5em 0 0 1.2em; padding:0;">
                            <li>Haz <b>click</b> en una pieza y luego <b>arr치strala</b> al robot para ubicarla.</li>
                            <li><b>Click y arrastrar</b> sobre una pieza ya colocada para moverla.</li>
                            <li><b>Doble click</b> sobre una pieza para rotarla.</li>
                            <li>Activa <b>Modo Borrar</b> y haz <b>doble click</b> en una pieza para eliminarla.</li>
                            <li>Haz click en <b>Aplicar Geometr칤a y Reiniciar Sim</b> para cargar el robot en el simulador.</li>
                            <li>Usa <b>Guardar Robot</b> para descargar tu dise침o y <b>Cargar Robot</b> para restaurarlo.</li>
                            <li>Puedes cargar un robot prearmado desde la lista desplegable.</li>
                        </ul>
                    </div>
                </div>
                <div class="robot-parameters">
                    <h3>Geometr칤a del Robot (en metros)</h3>
                    <label for="robotWidth">
                        Ancho (dist. ruedas) (m):
                        <input type="number" id="robotWidth" value="0.10" step="0.01" min="0.02">
                    </label>
                    
                    <label for="sensorOffset">
                        Offset Sensores Delante (m):
                        <input type="number" id="sensorOffset" value="0.05" step="0.005" min="0">
                    </label>
                    
                    <label for="sensorSpread">
                        Separaci칩n Sensores Laterales (m):
                        <input type="number" id="sensorSpread" value="0.03" step="0.005" min="0">
                    </label>
                    
                    <label for="sensorDiameter">
                        Di치metro Sensor (m):
                        <input type="number" id="sensorDiameter" value="0.005" step="0.001" min="0.001">
                    </label>
                    
                    <label for="sensorCount">
                        N칰mero de Sensores IR:
                        <select id="sensorCount">
                            <option value="2">2</option>
                            <option value="3" selected>3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </label>
                    
                    <button id="applyRobotGeometryButton">Aplicar Geometr칤a y Reiniciar Sim</button>
                    <div style="margin-top: 1em; display: flex; gap: 0.5em; align-items: center;">
                        <button id="saveRobotButton" style="flex:1; text-align:center;">Guardar Robot</button>
                        <label for="loadRobotInput" class="file-input-label" style="flex:1; text-align:center;">Cargar Robot (.json)</label>
                        <input type="file" id="loadRobotInput" accept=".json" style="display:none;">
                    </div>
                    <div style="margin-top: 1em;">
                        <label for="robotSelectionDropdown">Seleccionar Robot Predefinido:</label>
                        <select id="robotSelectionDropdown" style="width: 100%; margin-top: 0.5em;">
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Track Editor Tab -->
        <div id="track-editor" class="tab-content">
            <div class="track-editor-layout">
                <div class="track-editor-grid">
                    <canvas id="trackEditorCanvas"></canvas> <!-- Size set by JS -->
                </div>
                <div class="track-editor-controls">
                    <h3>Controles de Pista</h3>
                    <label for="trackGridSize">Tama침o Grid:</label>
                    <select id="trackGridSize">
                        <option value="3x3">3x3</option>
                        <option value="4x4" selected>4x4</option>
                        <option value="5x5">5x5</option>
                    </select>
                    <button id="generateRandomTrack">Generar Pista Aleatoria (Loop)</button>
                    <button id="exportTrackToSimulator">Usar en Simulaci칩n</button>
                    <button id="clearTrackButton" class="danger" style="margin-top:0.5em;">Limpiar Pista</button>
                    <hr>
                    <div style="display: flex; gap: 0.5em; align-items: center; margin-top: 1em;">
                        <button id="saveTrackDesignButton" style="flex:1; text-align:center;">Guardar Dise침o</button>
                        <label for="loadTrackDesignInput" class="file-input-label" style="flex:1; text-align:center;">Cargar Dise침o (.json)</label>
                        <input type="file" id="loadTrackDesignInput" accept=".json,.trackdesign" style="display:none;">
                    </div>
                </div>
                <div class="track-parts-palette-container">
                    <h3>Paleta de Piezas</h3>
                    <div id="trackPartsPalette">
                        <!-- Piezas se cargar치n aqu칤 por JS -->
                    </div>
                    <p class="small-text">Click para Ubicar, Doble-Click para rotar.</p>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>Simulador Avanzado de Seguidor de L칤nea - 2025. Ing. Luis Fernando Corado</p>
    </footer>

    <script type="module" src="js/main.js"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('service-worker.js')
            .then(function(registration) {
              console.log('ServiceWorker registrado con 칠xito:', registration.scope);
            }, function(err) {
              console.log('Error al registrar el ServiceWorker:', err);
            });
        });
      }
    </script>
</body>
</html>